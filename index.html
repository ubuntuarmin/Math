<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Katy Math</title>

  <!-- Tailwind (kept, since your JS uses the classes) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- New global modern stylesheet -->
  <link rel="stylesheet" href="style.css">

  <style>
    /* Spinning token */
    .token-spin { animation: spin 3s linear infinite; }
    @keyframes spin { from { transform: rotateY(0deg); } to { transform: rotateY(360deg); } }

    /* Loader */
    .loader { width:64px; height:64px; border-radius:50%; border:6px solid #1f2937; border-top:6px solid #22c55e; animation: spin 1s linear infinite; }

    /* Pulse effect */
    .pulse { animation: pulse 1.5s infinite; }
    @keyframes pulse { 0%{opacity:.3}50%{opacity:1}100%{opacity:.3} }

    /* Login modal */
    #loginModal { position:fixed; inset:0; z-index:50; }
    #loginModal:not(.hidden) { display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.8); }
    #loginModal .panel { width:320px; background:#0f172a; padding:18px; border-radius:8px; box-shadow:0 6px 30px rgba(0,0,0,0.6); border: 1px solid #1f2937; }
    #loginModal input { width:100%; margin-top:8px; padding:8px; background:#0b1220; border:1px solid #1f2937; color:#e5e7eb; border-radius:6px; outline: none; }
    #loginModal input:focus { border-color: #3b82f6; }
    #loginModal button { margin-top:12px; width:100%; }

    /* Fullscreen welcome overlay */
    #welcomeOverlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index:60; pointer-events:none; }
    #welcomeOverlay.show { display:flex; pointer-events:auto; }
    .welcome-full {
      width:100%; height:100%; display:flex; align-items:center; justify-content:center;
      background: linear-gradient(180deg, rgba(2,6,23,0.95), rgba(2,6,23,0.85));
      backdrop-filter: blur(6px);
    }
    .welcome-card {
      background: linear-gradient(135deg,#0ea5a4,#7c3aed);
      color:white; padding:30px 36px; border-radius:18px; box-shadow:0 20px 60px rgba(2,6,23,0.7);
      transform: translateY(20px) scale(.96); opacity: 0; display:flex; gap:18px; align-items:center;
      max-width:920px; width:90%;
    }
    .welcome-logo {
      width:88px; height:88px; border-radius:16px; background:rgba(255,255,255,.12); display:flex;
      align-items:center; justify-content:center; font-size:36px; transform-origin:center;
    }

    @keyframes welcome-pop {
      0% { transform: translateY(30px) scale(.94); opacity:0; }
      60% { transform: translateY(-8px) scale(1.03); opacity:1; }
      100% { transform: translateY(0) scale(1); opacity:1; }
    }
    @keyframes logo-bounce {
      0% { transform: translateY(0) rotate(-6deg) }
      50% { transform: translateY(-6px) rotate(8deg) }
      100% { transform: translateY(0) rotate(0deg) }
    }
    .welcome-card.animate { animation: welcome-pop 700ms cubic-bezier(.2,.9,.3,1) forwards; }
    .welcome-logo.animate { animation: logo-bounce 900ms cubic-bezier(.2,.9,.3,1) forwards; }

    /* Onboarding modal */
    #onboardModal { position:fixed; inset:0; z-index:70; }
    #onboardModal:not(.hidden) { display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.8); }
    #onboardModal .panel { width:420px; background:#071024; padding:20px; border-radius:12px; color:#e6eef8; border: 1px solid #1f2937; }

    /* daily streak interactive styles */
    .day-card { transition: transform .14s ease, box-shadow .14s ease; cursor: pointer; }
    .day-card:hover { transform: translateY(-6px) scale(1.02); box-shadow: 0 12px 30px rgba(2,6,23,0.6); }

    /* Custom Scrollbar for Header */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    /* --- INBOX STYLES --- */
    .notification-wrapper { position: relative; }
    #notifBadge {
      position: absolute;
      top: -2px;
      right: -2px;
      background: #ef4444;
      color: white;
      font-size: 10px;
      padding: 1px 5px;
      border-radius: 999px;
      border: 2px solid #1f2937;
      font-weight: bold;
    }
    #notifDropdown {
      position: absolute;
      right: 0;
      top: 50px;
      width: 300px;
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 12px;
      box-shadow: 0 20px 25px -5px rgba(0,0,0,0.5);
      padding: 12px;
      z-index: 100;
      max-height: 400px;
      overflow-y: auto;
    }
    #notifDropdown h3 {
      font-weight: bold;
      border-bottom: 1px solid #334155;
      padding-bottom: 8px;
      margin-bottom: 8px;
      color: #94a3b8;
      text-transform: uppercase;
      font-size: 11px;
      letter-spacing: 0.05em;
    }
    .notif-item {
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 4px;
      transition: background 0.2s;
      font-size: 13px;
    }
    .notif-item.unread {
      background: rgba(59, 130, 246, 0.1);
      border-left: 3px solid #3b82f6;
    }
    .notif-item:hover {
      background: rgba(255, 255, 255, 0.05);
    }
  </style>

  <script>
    (function() {
      const urlParams = new URLSearchParams(window.location.search);
      const ref = urlParams.get('ref');
      if (ref) {
        localStorage.setItem('pendingReferral', ref);
        window.history.replaceState({}, document.title, window.location.pathname);
      }
    })();
  </script>
</head>
<body class="page">

  <!-- Modern global header using style.css, but preserving your IDs/buttons -->
 <!-- REPLACE your current <header id="header">...</header> with this block -->

<header id="header" class="site-header hidden">
  <nav class="navbar">
    <!-- Left: Brand -->
    <a href="index.html" class="navbar-brand">
      <span class="navbar-brand-logo"></span>
      <span>Katy Math</span>
    </a>

    <!-- Mobile toggle (optional JS if you want to wire it later) -->
    <button class="nav-toggle" type="button">
      Menu
    </button>

    <!-- Right: Main controls -->
    <div class="navbar-nav">
      <!-- Credits pill -->
      <div class="flex items-center gap-3">
        <div class="flex items-center gap-2 px-3 py-1 rounded-full border border-gray-700/80 bg-black/40 shadow-sm">
          <div class="token-spin text-lg leading-none">ðŸª™</div>
          <div class="flex flex-col leading-tight">
            <span class="text-[10px] uppercase tracking-[0.18em] text-gray-400 font-semibold">
              Credits
            </span>
            <span id="creditCount" class="text-sm font-bold text-white">0</span>
          </div>
        </div>

        <!-- Tier label -->
        <button
          id="tierBtn"
          type="button"
          class="px-3 py-1 rounded-full text-[10px] font-semibold uppercase tracking-[0.16em] border border-cyan-500/40 bg-cyan-500/10 text-cyan-300 hover:bg-cyan-500/20 transition"
        >
          Tier:
          <span id="tierLabel" class="ml-1">Basic</span>
        </button>
      </div>

      <!-- Page nav buttons -->
      <div class="hidden md:flex items-center gap-1 ml-4">
        <button
          type="button"
          onclick="navigate('dashboard')"
          class="px-3 py-1.5 rounded-full text-xs font-medium text-gray-300 hover:text-white hover:bg-white/5 transition whitespace-nowrap"
        >
          Dashboard
        </button>
        <button
          type="button"
          onclick="navigate('tokens')"
          class="px-3 py-1.5 rounded-full text-xs font-medium text-gray-300 hover:text-white hover:bg-white/5 transition whitespace-nowrap"
        >
          Tokens
        </button>
        <button
          type="button"
          onclick="navigate('leaderboard')"
          class="px-3 py-1.5 rounded-full text-xs font-medium text-gray-300 hover:text-white hover:bg-white/5 transition whitespace-nowrap"
        >
          Leaderboard
        </button>
        <button
          type="button"
          onclick="navigate('account')"
          class="px-3 py-1.5 rounded-full text-xs font-medium text-gray-300 hover:text-white hover:bg-white/5 transition whitespace-nowrap"
        >
          Account
        </button>
      </div>

      <!-- Bell + Chat + Logout -->
      <div class="flex items-center gap-2 ml-3">
        <!-- Notifications bell -->
        <div class="notification-wrapper relative">
          <button
            id="notifBtn"
            class="w-9 h-9 flex items-center justify-center rounded-full border border-gray-700/80 bg-black/30 hover:bg-black/60 transition relative"
            type="button"
          >
            <span class="text-lg leading-none">ðŸ””</span>
            <span
              id="notifBadge"
              class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-[10px] px-1.5 py-[1px] rounded-full border border-gray-900 font-bold"
            >
              0
            </span>
          </button>
        </div>

        <!-- Chat link -->
        <a
          href="tutoring.html"
          class="hidden sm:inline-flex items-center justify-center px-3 py-1.5 rounded-full text-xs font-semibold border border-blue-500/60 bg-blue-500/15 text-blue-300 hover:bg-blue-500/25 transition whitespace-nowrap"
        >
          Chat
        </a>

        <!-- Logout -->
        <button
          id="logoutBtn"
          type="button"
          class="px-3 py-1.5 rounded-full text-xs font-semibold border border-red-500/60 bg-red-500/10 text-red-300 hover:bg-red-500/25 hover:text-red-50 transition whitespace-nowrap"
        >
          Logout
        </button>
      </div>
    </div>
  </nav>

  <!-- Existing floating inbox dropdown (kept as-is for JS) -->
  <div
    id="inboxDropdown"
    class="hidden absolute right-4 top-16 w-80 bg-gray-900 border border-gray-700 rounded-xl shadow-2xl z-50 overflow-hidden"
  >
    <div class="p-4 border-b border-gray-800 flex justify-between items-center bg-gray-800/50">
      <h3 class="font-bold text-white text-sm">Notifications</h3>
      <button
        id="markAllRead"
        class="text-[10px] text-blue-400 hover:underline uppercase font-bold tracking-[0.16em]"
      >
        Mark all as read
      </button>
    </div>
    <div id="inboxList" class="max-h-96 overflow-y-auto p-2 space-y-2">
      <div class="text-center py-8 text-gray-500 text-sm italic">No new messages</div>
    </div>
  </div>
</header>

  <main id="appContainer">
    <div class="container">
      <section class="surface" id="dashboardPage">
        <div id="siteInfoBox" class="mb-8 card">
          <button type="button" onclick="document.getElementById('siteInfoBox').remove()" class="absolute top-3 right-4 text-gray-500 hover:text-white transition text-xl">
            &times;
          </button>
          <div class="flex items-start gap-4">
            <div class="text-3xl">ðŸš€</div>
            <div>
              <h3 class="text-lg font-bold text-blue-400 mb-2">Beta Version 1.0</h3>
              <div class="text-sm text-gray-300 space-y-3 leading-relaxed">
                <p>
                  This is v1 betaâ€”there are lots of bugs, but we are working to fix them!
                  <span class="text-yellow-400 font-bold underline">PRO TIP:</span>
                  For now, use the <strong>3rd link</strong>.
                </p>
                <p>Share the site with your <strong>Referral URL</strong> to gain credits! You get 50, they get 20.</p>
              </div>
            </div>
          </div>
        </div>

        <h2 class="text-xl mb-4 font-bold text-gray-400 uppercase tracking-widest text-sm">
          General Links
        </h2>
        <div id="links" class="card-grid"></div>
      </section>

      <section id="tokensPage" class="hidden space-y-6 surface">
        <div class="card flex items-center gap-4">
          <div class="token-spin text-4xl">ðŸª™</div>
          <div>
            <div class="font-semibold text-lg">Next Reward</div>
            <div id="nextReward" class="text-green-400 text-sm font-mono uppercase"></div>
          </div>
        </div>

        <div class="card">
          <h3 class="font-bold text-gray-400 uppercase text-xs tracking-widest mb-4">
            Daily Streak
          </h3>
          <div id="dailyTracker" class="grid grid-cols-5 md:grid-cols-10 gap-3"></div>
        </div>
      </section>

      <section id="leaderboardPage" class="hidden surface">
        <h2 class="text-xl mb-4 font-bold">Weekly Leaderboard</h2>
        <div id="leaderboard" class="space-y-2"></div>
      </section>

      <section id="accountPage" class="hidden surface">
        <div class="space-y-4">
          <div id="accountInfo" class="space-y-1"></div>

          <div id="editProfileForm" class="hidden border-t border-gray-700 pt-4 mt-4 space-y-3">
            <h4 class="text-sm font-semibold text-gray-400 uppercase tracking-wider">Edit Profile</h4>
            <div class="grid grid-cols-2 gap-3">
              <input id="editFirst" type="text" placeholder="First Name" class="bg-gray-900 p-2 rounded border border-gray-700 outline-none focus:border-blue-500">
              <input id="editLast" type="text" placeholder="Last Name" class="bg-gray-900 p-2 rounded border border-gray-700 outline-none focus:border-blue-500">
            </div>
            <select id="editGrade" class="w-full bg-gray-900 p-2 rounded border border-gray-700">
              <option value="">Select grade</option>
              <option>Kindergarten</option>
              <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
              <option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
              <option>11</option><option>12</option>
            </select>
            <div class="flex gap-2">
              <button id="saveProfileBtn" type="button" class="bg-green-600 px-4 py-2 rounded text-sm font-bold">Save</button>
              <button id="cancelEditBtn" type="button" class="bg-gray-700 px-4 py-2 rounded text-sm font-bold">Cancel</button>
            </div>
          </div>

          <button id="showEditBtn" type="button" class="text-sm text-blue-400 hover:underline">
            Edit Profile
          </button>

          <div class="pt-4 border-t border-gray-700">
            <div class="text-sm text-gray-400">
              Total Minutes: <span id="totalMinutes" class="text-white font-mono">0</span>
            </div>
            <div id="referralArea" class="mt-3"></div>
          </div>

          <div class="pt-10 mt-10 border-t border-red-900/30">
            <h4 class="text-xs font-bold text-red-500 uppercase tracking-widest mb-2">
              Danger Zone
            </h4>
            <button
              id="deleteAccountBtn"
              type="button"
              class="bg-red-900/20 hover:bg-red-600 text-red-500 hover:text-white border border-red-900 px-4 py-2 rounded-lg text-xs font-bold transition"
            >
              Delete My Account
            </button>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- LOGIN MODAL -->
  <div id="loginModal" class="hidden">
    <div class="panel">
      <h3 class="text-lg font-bold text-center mb-4 text-blue-400">Katy Math</h3>
      <div id="loginError" class="text-red-400 text-xs mb-2 text-center"></div>
      <input id="email" type="email" placeholder="Email" />
      <input id="password" type="password" placeholder="Password" />
      <input id="referralCodeInput" type="text" placeholder="Referral code (optional)" />
      <div class="grid grid-cols-2 gap-2 mt-2">
        <button id="signInBtn" type="button" class="bg-blue-600 py-2 rounded font-bold hover:bg-blue-500">Sign In</button>
        <button id="signUpBtn" type="button" class="bg-green-600 py-2 rounded font-bold hover:bg-green-500">Sign Up</button>
      </div>
    </div>
  </div>

  <!-- ONBOARDING MODAL -->
  <div id="onboardModal" class="hidden">
    <div class="panel">
      <h3 class="text-lg font-bold mb-4">Welcome!</h3>
      <input id="onboardFirst" type="text" placeholder="First name" />
      <input id="onboardLast" type="text" placeholder="Last name" />
      <select id="onboardGrade" class="mt-2 w-full bg-gray-900 text-white p-2 rounded border border-gray-700">
        <option value="">Select Grade</option>
        <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
        <option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
        <option>11</option><option>12</option>
      </select>
      <button id="onboardSave" type="button" class="bg-blue-600 w-full py-2 rounded mt-4 font-bold">
        Save & Continue
      </button>
    </div>
  </div>

  <!-- WELCOME OVERLAY -->
  <div id="welcomeOverlay">
    <div class="welcome-full">
      <div class="welcome-card" id="welcomeCard">
        <div class="welcome-logo" id="welcomeLogo">âœ¨</div>
        <div>
          <div id="welcomeTitle" class="text-3xl font-bold">Welcome</div>
          <div id="welcomeSub" class="text-lg opacity-90 mt-1">Ready to earn some credits?</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts (unchanged) -->
  <script type="module" src="./js/firebase.js"></script>
  <script type="module" src="./js/utils.js"></script>
  <script type="module" src="./js/login.js"></script>
  <script type="module" src="./js/onboarding.js"></script>
  <script type="module" src="./js/auth.js"></script>
  <script type="module" src="./js/inbox.js"></script>
  <script type="module" src="./js/dashboard.js"></script>
  <script type="module" src="./js/tokens.js"></script>
  <script type="module" src="./js/leaderboard.js"></script>
  <script type="module" src="./js/account.js"></script>
  <script type="module" src="./js/welcome.js"></script>
  <script type="module" src="./js/blockExtensions.js"></script>
</body>
</html>
